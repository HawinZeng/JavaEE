# 品优04——安全框架与商家入驻审核

## 一、Spring Security框架

注意事项：

##### 1） 设置登录页面login.html、login_error.html不被拦截，防止出现“重定向次数过多错误！”

```xml
<http pattern="/*.html" security="none"></http>
<http pattern="/css/**" security="none"></http>
<http pattern="/img/**" security="none"></http>
<http pattern="/js/**" security="none"></http>
<http pattern="/plugins/**" security="none"></http>
```

> /**: 代表所有目录文件集合，多级分层； 
>
> /*: 只代表当前目录的所有文件，仅一层；

##### 2）CSRF：（Cross-site request forgery）跨站请求伪造，也被称为“One Click Attack”或者Session Riding，通常缩写为CSRF或者XSRF，是一种对网站的恶意利用。

```xml
<csrf disabled="true" />  <!--关闭csrf ,如果不加会出现错误 -->
```

> 由于jsp页面才能携带X-CSRF-TOKEN的header信息，即可防止CSRF攻击。但是项目都是html页面，则无法实现，所以我们需要关闭该配置！



## 二、运营商系统登录与安全控制

### 2.1、security的细节说明

```XML
<!-- 页面的拦截规则    use-expressions:是否启动SPEL表达式 默认是true -->
<http use-expressions="false">
    <!-- 当前用户必须有ROLE_USER的角色 才可以访问根目录及所属子目录的资源 -->
    <intercept-url pattern="/**" access="ROLE_ADMIN"/>
    <!-- 开启表单登陆功能 
login-processing-url='/login' : 这个代表登录请求路径，相当于controller-->

    <form-login login-page="/login.html" default-target-url="/admin/index.html" authentication-failure-url="/login.html" always-use-default-target="true"/>
    <csrf disabled="true"/>
    <!--页面通过frame集成其他网页进来，不进行拦截。不设置，则frame不会有内容展示-->
    <headers>
        <frame-options policy="SAMEORIGIN"/>
    </headers>
    <logout/>
</http>
```

### 2.2、显示登录用户信息

##### 1） 若是jsp页面，则直接可以使用jstl标签，通过security框架的直接将用户信息带到前端jsp页面显示即可！

```jsp
<%@ taglib prefix="security" uri="http://www.springframework.org/security/tags" %>

<li class="dropdown user user-menu">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown"> 
        <img  src="img/user2-160x160.jpg"  class="user-image" > 
        <span class="hidden-xs">
            <!--通过authentication标签，直接将用户名导入显示-->
    		<security:authentication property="principal.username"/>
    	</span>
    </a>
</li>
```

##### 2）若html页面，无法使用jstl标签，那只能自己定义controller一套来解决！

```js
app.controller('indexController',function($scope,loginService){
	$scope.name = function(){
		loginService.name().success(
				function(response){
					$scope.user = response;
				}
		);
	}
});
```

```java
@RequestMapping("/name")
public Map<String, String> name(){
    // 在security的api中获取用户信息
    String name = SecurityContextHolder.getContext().getAuthentication().getName();
    Map<String, String> map = new HashMap<>();
    map.put("name", name);
    return map;
}
```



## 三、商家申请入驻











































